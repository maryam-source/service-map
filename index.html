<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeff's Project Portfolio | Colorado</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root { --burgundy: #800000; --success-green: #27ae60; --star-gold: #fbc02d; }
        body { font-family: 'Montserrat', sans-serif; margin: 0; background-color: #fff; }
        .header { text-align: center; padding: 30px 20px; background: #fdfdfd; border-bottom: 1px solid #eee; }
        h1 { margin: 0; font-size: 1.8rem; font-weight: 700; color: #1a1a1a; }
        .subtitle { color: #666; font-size: 0.9rem; margin-top: 5px; }

        #map { 
            height: 700px; width: 95%; max-width: 1300px;
            margin: 20px auto; border-radius: 8px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 1px solid #ddd;
        }

        /* SMALLER LOGO MARKER */
        .logo-marker {
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.2));
            transition: 0.2s;
        }
        .logo-marker:hover { transform: scale(1.4); z-index: 1000 !important; }

        /* POPUP STYLING */
        .leaflet-popup-content-wrapper { border-radius: 4px; padding: 5px; }
        .value-label { font-size: 10px; color: #999; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 2px; }
        .value-amount { font-size: 18px; font-weight: 700; color: var(--success-green); margin-bottom: 8px; }
        .star-rating { color: var(--star-gold); font-size: 16px; margin-bottom: 8px; }
        .address-text { font-size: 12px; color: #444; border-top: 1px solid #eee; padding-top: 8px; line-height: 1.4; }
    </style>
</head>
<body>

    <div class="header">
        <h1>Project Portfolio: Colorado</h1>
        <p class="subtitle">Showcasing 100+ high-value installations across the state</p>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

    <script>
        const map = L.map('map', { scrollWheelZoom: false }).setView([40.1, -104.9], 8);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
            attribution: '©CartoDB'
        }).addTo(map);

        L.Control.geocoder({ defaultMarkGeocode: false, placeholder: "Search city or zip...", position: 'topright' })
            .on('markgeocode', e => map.setView(e.geocode.center, 12))
            .addTo(map);

        const logoIcon = L.icon({
            iconUrl: 'logo.png',
            iconSize: [20, 20], 
            iconAnchor: [12, 12],
            popupAnchor: [0, -12],
            className: 'logo-marker'
        });

        const formatter = new Intl.NumberFormat('en-US', {
            style: 'currency', currency: 'USD',
        });

        Papa.parse("data.csv", {
            download: true, header: true, skipEmptyLines: true,
            complete: function(results) {
                results.data.forEach(job => {
                    if(job.lat && job.lng && parseFloat(job.lat) !== 0) {
                        const priceDisplay = formatter.format(job.price);
                        
                        // Star logic: create a string of star characters based on the "stars" column
                        const starCount = parseInt(job.stars) || 5;
                        const starsHtml = '★'.repeat(starCount);

                        const popupContent = `
                            <div style="width:180px">
                                <div class="value-label">Total Job Amount</div>
                                <div class="value-amount">${priceDisplay}</div>
                                <div class="star-rating">${starsHtml}</div>
                                <div class="address-text"><strong>Site:</strong><br>${job.address}</div>
                            </div>
                        `;

                        L.marker([parseFloat(job.lat), parseFloat(job.lng)], {icon: logoIcon})
                            .addTo(map)
                            .bindPopup(popupContent);
                    }
                });
            }
        });
    </script>
</body>
</html>